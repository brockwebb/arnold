%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4A90A4', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2C5F6E', 'lineColor': '#5C6BC0'}}}%%

flowchart TB
    subgraph Orchestration["Orchestration Layer"]
        Claude["ðŸ¤– Claude Desktop<br/>Reasoning & Synthesis"]
    end

    subgraph Tools["MCP Tool Layer"]
        subgraph Core["Core Coaching"]
            Training["arnold-training-mcp<br/>â€¢ create_workout_plan<br/>â€¢ complete_as_written<br/>â€¢ complete_with_deviations<br/>â€¢ resolve_exercises"]
            Memory["arnold-memory-mcp<br/>â€¢ load_briefing<br/>â€¢ store_observation<br/>â€¢ search_observations<br/>â€¢ get_block_summary"]
        end
        
        subgraph Support["Support Services"]
            Journal["arnold-journal-mcp<br/>â€¢ log_entry<br/>â€¢ link_to_workout<br/>â€¢ get_recent_entries<br/>â€¢ create_annotation"]
            Analytics["arnold-analytics-mcp<br/>â€¢ get_readiness_snapshot<br/>â€¢ get_training_load<br/>â€¢ check_red_flags<br/>â€¢ run_sync"]
            Profile["arnold-profile-mcp<br/>â€¢ get_profile<br/>â€¢ record_observation<br/>â€¢ list_equipment"]
        end
    end

    subgraph Data["Data Layer (ADR-001)"]
        subgraph Graph["Neo4j - Right Brain"]
            Person["Person"]
            Goals["Goals"]
            Modality["Modalities"]
            Block["Blocks"]
            Exercise["Exercises (4,242)"]
            Injury["Injuries"]
            Observations["Observations"]
        end
        
        subgraph Facts["Postgres - Left Brain"]
            Strength["strength_sessions (165)<br/>strength_sets (2,482)"]
            Biometrics["biometric_readings<br/>(3,600+)"]
            Logs["log_entries"]
            Annotations["data_annotations"]
            Traces["decision_traces<br/>(ADR-004)"]
        end
    end

    Claude --> Training
    Claude --> Memory
    Claude --> Journal
    Claude --> Analytics
    Claude --> Profile

    Training --> Graph
    Training --> Facts
    Memory --> Graph
    Journal --> Graph
    Journal --> Facts
    Analytics --> Facts
    Profile --> Graph

    Person --> Goals
    Goals --> Modality
    Person --> Block
    Block --> Modality
    Exercise --> |"INVOLVES"| Modality

    style Orchestration fill:#E8EAF6,stroke:#3F51B5
    style Tools fill:#E3F2FD,stroke:#1565C0
    style Data fill:#FFF8E1,stroke:#FF8F00
